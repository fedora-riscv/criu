From 175fb94e620f9e33358e92bec0262e0586ec554a Mon Sep 17 00:00:00 2001
From: Adrian Reber <areber@redhat.com>
Date: Wed, 27 Oct 2021 07:27:22 +0000
Subject: [PATCH 026/249] ci: replace deprecated codecov bash uploader

Replace deprecated codecov bash uploader with new version:

https://about.codecov.io/blog/introducing-codecovs-new-uploader/

Signed-off-by: Adrian Reber <areber@redhat.com>
---
 .github/workflows/gcov-test.yml | 2 ++
 Makefile                        | 4 +++-
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/.github/workflows/gcov-test.yml b/.github/workflows/gcov-test.yml
index f1b38e77e..f782c5b9d 100644
--- a/.github/workflows/gcov-test.yml
+++ b/.github/workflows/gcov-test.yml
@@ -10,5 +10,7 @@ jobs:
     - uses: actions/checkout@v2
     - name: Run Coverage Tests
       run: sudo -E make -C scripts/ci local GCOV=1
+    - name: Run gcov
+      run: sudo -E find . -name '*gcda' -type f -print0 | sudo -E xargs --null --max-args 128 --max-procs 4 gcov
     - name: Run Coverage Analysis
       run: sudo -E make codecov
diff --git a/Makefile b/Makefile
index 1f0dec78b..c0b8b7e54 100644
--- a/Makefile
+++ b/Makefile
@@ -431,7 +431,9 @@ lint:
 
 codecov: SHELL := $(shell which bash)
 codecov:
-	bash <(curl -s https://codecov.io/bash)
+	curl -Os https://uploader.codecov.io/latest/linux/codecov
+	chmod +x codecov
+	./codecov
 .PHONY: codecov
 
 fetch-clang-format: .FORCE
-- 
2.35.1

