From 247e677678fdc049d6e827315976a04527f5d84d Mon Sep 17 00:00:00 2001
From: Pavel Tikhomirov <ptikhomirov@virtuozzo.com>
Date: Tue, 21 Dec 2021 12:14:23 +0300
Subject: [PATCH 209/249] files-reg: export parent dirs helpers for mount-v2

Signed-off-by: Pavel Tikhomirov <ptikhomirov@virtuozzo.com>
---
 criu/files-reg.c         | 4 ++--
 criu/include/files-reg.h | 3 +++
 2 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/criu/files-reg.c b/criu/files-reg.c
index 636853ac8..e998b3040 100644
--- a/criu/files-reg.c
+++ b/criu/files-reg.c
@@ -1873,7 +1873,7 @@ out:
 	return ret;
 }
 
-static int rm_parent_dirs(int mntns_root, char *path, int count)
+int rm_parent_dirs(int mntns_root, char *path, int count)
 {
 	char *p, *prev = NULL;
 	int ret = -1;
@@ -1912,7 +1912,7 @@ err:
 }
 
 /* Construct parent dir name and mkdir parent/grandparents if they're not exist */
-static int make_parent_dirs_if_need(int mntns_root, char *path)
+int make_parent_dirs_if_need(int mntns_root, char *path)
 {
 	char *p, *last_delim;
 	int err, count = 0;
diff --git a/criu/include/files-reg.h b/criu/include/files-reg.h
index 953d50288..d4934c4ae 100644
--- a/criu/include/files-reg.h
+++ b/criu/include/files-reg.h
@@ -58,4 +58,7 @@ static inline int link_strip_deleted(struct fd_link *link)
 
 extern int dead_pid_conflict(void);
 
+extern int rm_parent_dirs(int mntns_root, char *path, int count);
+extern int make_parent_dirs_if_need(int mntns_root, char *path);
+
 #endif /* __CR_FILES_REG_H__ */
-- 
2.35.1

